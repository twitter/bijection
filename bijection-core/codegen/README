This code may be removed when we move to scala 2.10 (and macros)
